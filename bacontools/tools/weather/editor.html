<div class="max-w-5xl my-8 mx-auto px-4 py-6 bg-gray-800 rounded-xl border border-gray-700">
  <div class="flex items-center justify-between mb-6">
    <button id="dash" class="text-indigo-400 hover:text-indigo-300 flex items-center gap-2 text-2xl">
      <i class="fa-solid fa-arrow-rotate-left"></i>
    </button>
    <h2 class="text-3xl font-bold text-center flex-1 flex items-center justify-center gap-3">
      <div class="hidden sm:flex"><i class="fa-solid fa-cloud-sun-rain text-indigo-400 text-4xl"></i></div> Weather Overlay
    </h2>
  </div>
  <div class="grid md:grid-cols-2 gap-10">
    <!-- LEFT: Controls -->
    <div class="space-y-6">
      <!-- Location -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1">Location (city or zip)</label>
        <input id="location" type="text" value="Phoenix" placeholder="Phoenix, Seattle, 85001" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
      </div>
      <!-- Style -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1">Style</label>
        <select id="style" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
          <option value="basic">Basic (text only)</option>
          <option value="gradient">Gradient background</option>
          <option value="blur">Blur box</option>
        </select>
      </div>
      <!-- Font Size -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1">Font Size (px)</label>
        <input id="fontSize" type="number" value="40" min="16" max="120" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
      </div>
      <!-- Text Color -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1">Text Color</label>
        <div class="flex items-center gap-3">
          <input type="color" id="textColor" value="#ffffff" class="w-10 h-10 rounded cursor-pointer bg-transparent border border-gray-600">
          <input type="text" id="textColorHex" value="#ffffff" class="w-28 bg-gray-700 border border-gray-600 rounded px-3 py-1 text-white text-sm">
        </div>
      </div>
      <!-- Background Color -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1">Background Color</label>
        <div class="flex items-center gap-3">
          <input type="color" id="bgColor" value="#000000" class="w-10 h-10 rounded cursor-pointer bg-transparent border border-gray-600">
          <input type="text" id="bgColorHex" value="#000000" class="w-28 bg-gray-700 border border-gray-600 rounded px-3 py-1 text-white text-sm">
        </div>
      </div>
      <!-- Background Opacity -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1">Background Opacity (0–1)</label>
        <input id="bgOpacity" type="number" step="0.05" min="0" max="1" value="0.6" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
      </div>
      <!-- Refresh interval -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1">Refresh every (minutes)</label>
        <input id="refresh" type="number" value="15" min="5" max="60" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
      </div>
      <!-- Position on Screen -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1">Position</label>
        <select id="position" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
          <option value="top-right">Top Right</option>
          <option value="top-center">Top Center</option>
          <option value="top-left">Top Left</option>
          <option value="bottom-left">Bottom Left</option>
          <option value="bottom-center">Bottom Center</option>
          <option value="bottom-right">Bottom Right</option>
          <option value="center">Center</option>
        </select>
      </div>
      <!-- Margins -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-xs text-gray-400 mb-1">Horizontal Margin (px)</label>
          <input id="marginX" type="number" value="20" min="0" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
        </div>
        <div>
          <label class="block text-xs text-gray-400 mb-1">Vertical Margin (px)</label>
          <input id="marginY" type="number" value="20" min="0" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
        </div>
      </div>
      <!-- Canvas size -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Canvas Width (px)</label>
          <input id="width" type="number" value="1920" min="640" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Canvas Height (px)</label>
          <input id="height" type="number" value="1080" min="360" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
        </div>
      </div>

    </div>
    <!-- RIGHT: Preview -->
    <div class="space-y-6">
      <div>
        <h2 class="text-xl font-semibold mb-3">Live Preview</h2>
        <div id="previewWrapper" class="relative mx-auto bg-gray-900 rounded-xl overflow-hidden border border-gray-700 shadow-2xl" style="width: 100%; max-width: 960px; aspect-ratio: 16 / 9;">
          <iframe id="previewFrame" src="/bacontools/tools/socials/overlay.html" frameborder="0" class="absolute inset-0 w-full h-full origin-top-left"></iframe>
        </div>
      </div>
      <label class="block text-sm font-medium text-gray-300 mb-2">OBS URL (copy this)</label>
      <div class="flex">
        <input id="urlBox" type="text" readonly class="flex-1 bg-gray-700 border border-gray-600 rounded-l px-3 py-2 text-gray-300">
        <button id="copyBtn" class="bg-indigo-400 hover:bg-indigo-300 px-4 rounded-r text-white">Copy</button>
      </div>
      <div class="mt-4 text-gray-400 text-sm">
        <p class="font-semibold mb-2">How to use:</p>
        <ul class="list-disc pl-5 space-y-1">
          <li>Customize the options — changes update live in the preview.</li>
          <li>Copy the URL below and paste it into <a href="https://obsproject.com/" target="_blank" class="text-indigo-400 hover:text-indigo-300">OBS</a> as a Browser Source. </li>
          <li>Match the canvas size to your stream resolution (e.g. 1920x1080).</li>
          <li>If the preview looks cropped, try refreshing the page or adjusting size.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<script>
  (function() {
    const elements = {
      location: document.getElementById('location'),
      style: document.getElementById('style'),
      fontSize: document.getElementById('fontSize'),
      textColor: document.getElementById('textColor'),
      textColorHex: document.getElementById('textColorHex'),
      bgColor: document.getElementById('bgColor'),
      bgColorHex: document.getElementById('bgColorHex'),
      bgOpacity: document.getElementById('bgOpacity'),
      refresh: document.getElementById('refresh'),
      position: document.getElementById('position'),
      marginX: document.getElementById('marginX'),
      marginY: document.getElementById('marginY'),
      width: document.getElementById('width'),
      height: document.getElementById('height'),
      urlBox: document.getElementById('urlBox'),
      previewFrame: document.getElementById('previewFrame'),
      copyBtn: document.getElementById('copyBtn')
    };

    function updatePreview() {
      const bg = elements.bgColor.value || '#000000';
      const opacity = elements.bgOpacity.value || 0.6;
      const bgRgba = bg.replace(/^#([A-Fa-f0-9]{6})$/, '#$1') + opacity.toString().slice(1); // simple rgba conversion
      const params = new URLSearchParams({
        location: encodeURIComponent(elements.location.value.trim() || 'Phoenix'),
        style: elements.style.value || 'basic',
        fontSize: elements.fontSize.value || 40,
        textColor: elements.textColor.value || '#ffffff',
        bgColor: bgRgba,
        refresh: elements.refresh.value || 15,
        position: elements.position.value || 'center',
        marginX: elements.marginX.value || 20,
        marginY: elements.marginY.value || 20,
        w: elements.width.value || 1920,
        h: elements.height.value || 1080
      });
      const src = `/bacontools/tools/weather/overlay.html?${params}`;
      elements.previewFrame.src = src;
      elements.urlBox.value = new URL(src, window.location.origin).href;
      setTimeout(() => {
        const realW = parseInt(elements.width.value) || 1920;
        const realH = parseInt(elements.height.value) || 1080;
        const wrapper = document.getElementById('previewWrapper');
        if (wrapper && elements.previewFrame) {
          const scale = Math.min(wrapper.clientWidth / realW, wrapper.clientHeight / realH);
          elements.previewFrame.style.transform = `scale(${scale})`;
          elements.previewFrame.style.width = `${realW}px`;
          elements.previewFrame.style.height = `${realH}px`;
        }
      }, 500);
    }
    // Live updates
    [elements.location, elements.style, elements.fontSize, elements.textColor, elements.bgColor, elements.bgOpacity, elements.refresh, elements.position, elements.marginX, elements.marginY, elements.width, elements.height].forEach(el => {
      if (el) {
        el.addEventListener('input', updatePreview);
        if (el.tagName === 'SELECT') el.addEventListener('change', updatePreview);
      }
    });
    // Color sync
    elements.textColor.addEventListener('input', () => {
      elements.textColorHex.value = elements.textColor.value;
      updatePreview();
    });
    elements.textColorHex.addEventListener('input', e => {
      if (/^#[0-9A-Fa-f]{6}$/i.test(e.target.value)) {
        elements.textColor.value = e.target.value;
        updatePreview();
      }
    });
    elements.bgColor.addEventListener('input', () => {
      elements.bgColorHex.value = elements.bgColor.value;
      updatePreview();
    });
    elements.bgColorHex.addEventListener('input', e => {
      if (/^#[0-9A-Fa-f]{6}$/i.test(e.target.value)) {
        elements.bgColor.value = e.target.value;
        updatePreview();
      }
    });
    updatePreview();
    // Copy button
    elements.copyBtn.addEventListener('click', () => {
      elements.urlBox.select();
      document.execCommand('copy');
      elements.copyBtn.innerHTML = ' < i class = "fas fa-check mr-2" > < /i>Copied!';
      setTimeout(() => elements.copyBtn.textContent = 'Copy', 1800);
    });
    // Back button
    document.getElementById('dash').addEventListener('click', () => {
      document.getElementById('tool-container').innerHTML = '';
      document.getElementById('tool-container').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
    });
  })();
</script>